# å…¨å±€é…ç½® é€‚ç”¨äºmihomeå†…æ ¸+é˜²æ­¢DNSæ³„æ¼
mode: rule #é€‰æ‹©mihomeè¿œè¡ŒçŠ¶æ€
ipv6: false #ipv6çŠ¶æ€
log-level: debug #æ—¥å¿—è¾“å‡ºçº§åˆ«
allow-lan: false #å…è®¸å±€åŸŸç½‘è¿æ¥
mixed-port: 7890 #æ··åˆä»£ç†ç«¯å£
unified-delay: true # å¼€å¯ç»Ÿä¸€å»¶è¿Ÿæ—¶
tcp-concurrent: false #TCPå¹¶å‘
# WEBUIå¤–éƒ¨æ§åˆ¶
external-controller: 127.0.0.1:9090 #uiç•Œé¢è®¿é—®ç«¯å£
external-ui: metacubexd #uiç•Œé¢åœ¨æœ¬åœ°æ–‡ä»¶å¤¹çš„å‘½å
external-ui-url: "https://github.com/MetaCubeX/metacubexd/archive/refs/heads/gh-pages.zip" #ä½¿ç”¨çš„uiç•Œé¢çš„urlåœ°å€
keep-alive-interval: 3600
#ä½¿ç”¨rulesetï¼Œä¸ä½¿ç”¨geodata
geodata-mode: false
# ç¼“å­˜ 
profile:
  store-selected: true
  # å‚¨å­˜ API å¯¹ç­–ç•¥ç»„çš„é€‰æ‹©
  store-fake-ip: false
  # å‚¨å­˜ fakeip æ˜ å°„è¡¨ï¼Œæœ¬é…ç½®ä¸ä½¿ç”¨fakeip
  
# åŸŸåå—…æ¢
#sniffer:
  #enable: true
  #force-dns-mapping: true
  #parse-pure-ip: true
  #override-destination: true
  #sniff:
    #HTTP:
      #ports: [80, 8080-8880]
      #override-destination: true
    #TLS:
      #ports: [443, 8443]
    #QUIC:
      #ports: [443, 8443]
  #force-domain:
    #- +.v2ex.com
  #skip-domain:
    #- Mijia Cloud
    
#TUNè®¾ç½®
#tun:
  #enable: true
  #stack: system
  #dns-hijack:
    #- any:53
  #auto-route: true
  #auto-detect-interface: true
    
# DNSè®¾ç½®â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
dns:
  enable: true
  listen: 0.0.0.0:1053
  ipv6: false
  prefer-h3: false
  nameserver:
    - https://223.5.5.5/dns-query#h3=true&é¦™æ¸¯
    - https://223.6.6.6/dns-query#h3=true&é¦™æ¸¯
  nameserver-policy:
    "rule-set:reject": rcode://success
    "rule-set:bilibili": https://223.5.5.5/dns-query#h3=true&é¦™æ¸¯
    "rule-set:OpeanAI": https://8.8.8.8/dns-query#h3=true&é¦™æ¸¯
    "rule-set:github": https://8.8.8.8/dns-query#h3=true&é¦™æ¸¯
    "rule-set:youtube": https://8.8.8.8/dns-query#h3=true&é¦™æ¸¯
    "rule-set:google": https://8.8.8.8/dns-query#h3=true&é¦™æ¸¯
    "rule-set:google-cn": https://8.8.8.8/dns-query#h3=true&é¦™æ¸¯
    "rule-set:tiktok": https://8.8.8.8/dns-query#h3=true&é¦™æ¸¯
    "rule-set:microsoft": https://8.8.8.8/dns-query#h3=true&é¦™æ¸¯
    "rule-set:microsoft-cn": https://8.8.8.8/dns-query#h3=true&é¦™æ¸¯
    "rule-set:apple-cn": https://8.8.8.8/dns-query#h3=true&é¦™æ¸¯
    "rule-set:direct":
      - https://223.5.5.5/dns-query#h3=true
      - https://223.6.6.6/dns-query#h3=true
  proxy-server-nameserver:
      - https://8.8.8.8/dns-query
      - https://223.5.5.5/dns-query

# èŠ‚ç‚¹é…ç½®â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
UrlTest: &UrlTest {type: url-test, interval: 6, tolerance: 20, lazy: true, url: 'http://www.google.com/blank.html', disable-udp: false, timeout: 2000, max-failed-times: 3, hidden: true, include-all-providers: true}
# ä»¥ä¸Šæ—¶å»¶ä¼˜é€‰å‚æ•° [æ¯ 6 ç§’ä¸€æ¬¡æƒ°æ€§å¥åº·æ£€æŸ¥ï¼Œå®¹å·® 20msï¼Œæ—¶å»¶è¶…è¿‡ 2 ç§’åˆ¤å®šä¸ºå¤±è´¥ï¼Œå¤±è´¥ 3 æ¬¡åˆ™è‡ªåŠ¨è§¦å‘å¥åº·æ£€æŸ¥]
RuleProviders: &RuleProviders {type: http, behavior: classical, interval: 3600, format: yaml, proxy: DIRECT}
# ä»¥ä¸Šè§„åˆ™å‚æ•° [æ¯å°æ—¶æ›´æ–°ä¸€æ¬¡è®¢é˜…è§„åˆ™ï¼Œæ›´æ–°è§„åˆ™æ—¶ä½¿ç”¨ç›´è¿]

# èŠ‚ç‚¹è®¢é˜…ï¼ˆæœºåœºè®¢é˜…ï¼‰â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
proxy-providers:
  ä¸­å›½å›½é™…è®¢é˜…:
    type: http
    url: "è¯·è¾“å…¥è®¢é˜…url"
    path: ./ä¸­å›½å›½é™…è®¢é˜….yaml
    exclude-filter: "å®˜ç½‘|å›å›½|å›½å†…|å›½é™…|ç§»åŠ¨|è”é€š|ç”µä¿¡|æ³°å›½|ä¿„ç½—æ–¯|ä¹Œå…‹å…°|åœŸè€³å…¶|å¾·å›½|é˜¿æ ¹å»·|ä¸‹è½½|æ›´æ–°|æµ‹è¯•|æ‹‰æ–¯ç»´åŠ æ–¯"
    health-check:
      enable: false
      url: https://1.1.1.1
    override:
      additional-prefix: "[ä¸­å›½å›½é™…è®¢é˜…] " # ä¸ºè®¢é˜…èŠ‚ç‚¹æ·»åŠ æœºåœºåç§°å‰ç¼€
      udp: true
# ç‹¬ç«‹çš„å‡ºç«™ä»£ç†
proxies:
  - { name: "dnsåŠ«æŒ", type: dns}


# èŠ‚ç‚¹ç­›é€‰â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
FilterHK: &FilterHK '^(?=.*((?i)ğŸ‡­ğŸ‡°|é¦™æ¸¯|(\b(HK|Hong)(\d+)?\b)))(?!.*((?i)å›å›½|æ ¡å›­|æ¸¸æˆ|ğŸ®|(\b(GAME)\b))).*$'
FilterTW: &FilterTW '^(?=.*((?i)ğŸ‡¹ğŸ‡¼|å°æ¹¾|(\b(TW|Tai|Taiwan)(\d+)?\b)))(?!.*((?i)å›å›½|æ ¡å›­|æ¸¸æˆ|ğŸ®|(\b(GAME)\b))).*$'
FilterJP: &FilterJP '^(?=.*((?i)ğŸ‡¯ğŸ‡µ|æ—¥æœ¬|å·æ—¥|ä¸œäº¬|å¤§é˜ª|æ³‰æ—¥|åŸ¼ç‰|(\b(JP|Japan)(\d+)?\b)))(?!.*((?i)å›å›½|æ ¡å›­|æ¸¸æˆ|ğŸ®|(\b(GAME)\b))).*$'
FilterKR: &FilterKR '^(?=.*((?i)ğŸ‡°ğŸ‡·|éŸ©å›½|éŸ“|é¦–å°”|(\b(KR|Korea)(\d+)?\b)))(?!.*((?i)å›å›½|æ ¡å›­|æ¸¸æˆ|ğŸ®|(\b(GAME)\b))).*$'
FilterSG: &FilterSG '^(?=.*((?i)ğŸ‡¸ğŸ‡¬|æ–°åŠ å¡|ç‹®|(\b(SG|Singapore)(\d+)?\b)))(?!.*((?i)å›å›½|æ ¡å›­|æ¸¸æˆ|ğŸ®|(\b(GAME)\b))).*$'
FilterUS: &FilterUS '^(?=.*((?i)ğŸ‡ºğŸ‡¸|ç¾å›½|æ³¢ç‰¹å…°|è¾¾æ‹‰æ–¯|ä¿„å‹’å†ˆ|å‡¤å‡°åŸ|è´¹åˆ©è’™|ç¡…è°·|æ‹‰æ–¯ç»´åŠ æ–¯|æ´›æ‰çŸ¶|åœ£ä½•å¡|åœ£å…‹æ‹‰æ‹‰|è¥¿é›…å›¾|èŠåŠ å“¥|(\b(US|United States)(\d+)?\b)))(?!.*((?i)å›å›½|æ ¡å›­|æ¸¸æˆ|ğŸ®|(\b(GAME)\b))).*$'
FilterUK: &FilterUK '^(?=.*((?i)ğŸ‡¬ğŸ‡§|è‹±å›½|ä¼¦æ•¦|(\b(UK|United Kingdom)(\d+)?\b)))(?!.*((?i)å›å›½|æ ¡å›­|æ¸¸æˆ|ğŸ®|(\b(GAME)\b))).*$'
FilterFR: &FilterFR '^(?=.*((?i)ğŸ‡«ğŸ‡·|æ³•å›½|(\b(FR|France)(\d+)?\b)))(?!.*((?i)å›å›½|æ ¡å›­|æ¸¸æˆ|ğŸ®|(\b(GAME)\b))).*$'
FilterAll: &FilterAll '^(?=.*((?i)é¦™æ¸¯|å°æ¹¾|æ—¥æœ¬|éŸ©å›½|æ–°åŠ å¡|ç¾å›½|è‹±å›½|æ³•å›½))(?!.*((?i)å›å›½|æ ¡å›­|æ¸¸æˆ|ğŸ®|(\b(GAME)\b))).*$'

# ç­–ç•¥ç»„â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
proxy-groups: 
  - {name: å…¨çƒé€‰æ‹©, type: select, include-all-providers: true, filter: *FilterAll}
  - {name: æ²¹ç®¡ç­–ç•¥, type: select, proxies: [é¦™æ¸¯, å°æ¹¾, æ—¥æœ¬, éŸ©å›½, æ–°å›½, ç¾å›½, è‹±å›½, æ³•å›½]}
  - {name: ç”µæŠ¥ç­–ç•¥, type: select, proxies: [é¦™æ¸¯, å°æ¹¾, æ—¥æœ¬, éŸ©å›½, æ–°å›½, ç¾å›½, è‹±å›½, æ³•å›½,]}
  - {name: TikTok, type: select, proxies: [æ—¥æœ¬, é¦™æ¸¯, å°æ¹¾, éŸ©å›½, æ–°å›½, ç¾å›½, è‹±å›½, æ³•å›½]}
  - {name: OpeanAI, type: select, proxies: [å°æ¹¾, é¦™æ¸¯, æ—¥æœ¬, éŸ©å›½, æ–°å›½, ç¾å›½, è‹±å›½, æ³•å›½]}
  - {name: è°·æ­Œç­–ç•¥, type: select, proxies: [é¦™æ¸¯, å°æ¹¾, æ—¥æœ¬, éŸ©å›½, æ–°å›½, ç¾å›½, è‹±å›½, æ³•å›½,]}
  - {name: å¾®è½¯ç­–ç•¥, type: select, proxies: [DIRECT, é¦™æ¸¯, å°æ¹¾, æ—¥æœ¬, éŸ©å›½, æ–°å›½, ç¾å›½, è‹±å›½, æ³•å›½]}
  - {name: è‹¹æœæœåŠ¡, type: select, proxies: [DIRECT, é¦™æ¸¯, å°æ¹¾, æ—¥æœ¬, éŸ©å›½, æ–°å›½, ç¾å›½, è‹±å›½, æ³•å›½]}
# æ—¶å»¶ä¼˜é€‰ç»„
  - {name: é¦™æ¸¯, <<: *UrlTest, filter: *FilterHK}
  - {name: å°æ¹¾, <<: *UrlTest, filter: *FilterTW}
  - {name: æ—¥æœ¬, <<: *UrlTest, filter: *FilterJP}
  - {name: éŸ©å›½, <<: *UrlTest, filter: *FilterKR}
  - {name: æ–°å›½, <<: *UrlTest, filter: *FilterSG}
  - {name: ç¾å›½, <<: *UrlTest, filter: *FilterUS}
  - {name: è‹±å›½, <<: *UrlTest, filter: *FilterUK}
  - {name: æ³•å›½, <<: *UrlTest, filter: *FilterFR}
  - {name: å…œåº•ç­–ç•¥, type: select, proxies: [é¦™æ¸¯, å°æ¹¾, æ—¥æœ¬, éŸ©å›½, æ–°å›½, ç¾å›½, è‹±å›½, æ³•å›½]}

# è®¢é˜…è§„åˆ™ï¼ˆè¿œç¨‹è§„åˆ™ï¼‰â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
rule-providers:
  direct:
    type: http
    behavior: domain
    format: mrs
    url: "https://github.com/DustinWin/ruleset_geodata/releases/download/clash-ruleset/cn.mrs"
  GeoIP:
    type: http
    behavior: ipcidr
    format: mrs
    url: "https://github.com/DustinWin/ruleset_geodata/releases/download/clash-ruleset/cnip.mrs"
  reject:
    type: http
    behavior: domain
    format: mrs
    url: "https://github.com/DustinWin/ruleset_geodata/releases/download/clash-ruleset/ads.mrs"
  OpeanAI:
    type: http
    behavior: domain
    format: mrs
    url: "https://github.com/DustinWin/ruleset_geodata/releases/download/clash-ruleset/ai.mrs"
  telegramip:
    type: http
    behavior: ipcidr
    format: mrs
    url: "https://github.com/DustinWin/ruleset_geodata/releases/download/clash-ruleset/telegramip.mrs"
  youtube:
    type: http
    behavior: domain
    format: mrs
    url: "https://github.com/DustinWin/ruleset_geodata/releases/download/clash-ruleset/youtube.mrs"
  bilibili:
    type: http
    behavior: domain
    format: mrs
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/bilibili.mrs"
  github:
    type: http
    behavior: classical
    format: yaml
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/GitHub/GitHub_No_Resolve.yaml"
  google:
    type: http
    behavior: domain
    format: mrs
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/google.mrs"
  google-cn:
    type: http
    behavior: domain
    format: mrs
    url: "https://github.com/DustinWin/ruleset_geodata/releases/download/clash-ruleset/google-cn.mrs"
  googlefcm:
    type: http
    behavior: domain
    format: mrs
    url: "https://github.com/MetaCubeX/meta-rules-dat/raw/meta/geo/geosite/googlefcm.mrs"
  tiktok:
    type: http
    behavior: domain
    format: mrs
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/tiktok.mrs"
  microsoft:
    type: http
    behavior: domain
    format: mrs
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/microsoft.mrs"
  microsoft-cn:
    type: http
    behavior: domain
    format: mrs
    url: "https://github.com/DustinWin/ruleset_geodata/releases/download/clash-ruleset/microsoft-cn.mrs"
  apple-cn:
    type: http
    behavior: domain
    format: mrs
    url: "https://github.com/DustinWin/ruleset_geodata/releases/download/mihomo-ruleset/apple-cn.mrs"

# è§„åˆ™æŒ‡å‘â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
rules:
  - DST-PORT,53,dnsåŠ«æŒ #dnsåŠ«æŒ53ç«¯å£
  - OR,((DST-PORT,853),(DOMAIN-KEYWORD,stun),(DOMAIN-KEYWORD,turn)),REJECT # å±è”½853ç«¯å£ã€WebRTC
  - AND,((DST-PORT,443),(NETWORK,UDP),(RULE-SET,youtube)),REJECT # å±è”½YouTube quic
  - AND,((DST-PORT,443),(NETWORK,UDP),(RULE-SET,bilibili)),REJECT # å±è”½Bilibili quic
  - RULE-SET,reject,REJECT

  - DOMAIN-KEYWORD, cdn.xdmdesigns.org, DIRECT,no-resolve # çœæµ
  - DOMAIN-KEYWORD, mushroomtrack.com, DIRECT,no-resolve  # çœæµ
  - DOMAIN-SUFFIX, fourhoi.com, DIRECT,no-resolve # çœæµ
  - DOMAIN-SUFFIX, nineyu.com, DIRECT,no-resolve # çœæµ
  - DOMAIN-SUFFIX, surrit.com, DIRECT,no-resolve # çœæµ
  - DOMAIN-KEYWORD, missav.recombee.com, DIRECT,no-resolve # çœæµ
  - DOMAIN-SUFFIX, client-rapi-missav.recombee.com, DIRECT,no-resolve # çœæµ

  - RULE-SET,youtube,æ²¹ç®¡ç­–ç•¥
  - RULE-SET,telegramip,ç”µæŠ¥ç­–ç•¥,no-resolve
  - RULE-SET,OpeanAI,OpeanAI
  - RULE-SET,github,é¦™æ¸¯
  - RULE-SET,tiktok,TikTok
  - RULE-SET,bilibili,REJECT
  - DOMAIN-SUFFIX,xn--ngstr-lra8j.com,é¦™æ¸¯
  - DOMAIN-SUFFIX,services.googleapis.cn,é¦™æ¸¯
  - OR,((RULE-SET,googlefcm),(DST-PORT,5228-5230)),è°·æ­Œç­–ç•¥
  - RULE-SET,google,è°·æ­Œç­–ç•¥
  - RULE-SET,google-cn,è°·æ­Œç­–ç•¥
  - RULE-SET,microsoft,å¾®è½¯ç­–ç•¥,no-resolve
  - RULE-SET,microsoft-cn,å¾®è½¯ç­–ç•¥,no-resolve
  - RULE-SET,apple-cn,REJECT,no-resolve
  - RULE-SET,direct,DIRECT
  - RULE-SET,GeoIP,DIRECT,no-resolve
  - MATCH,å…œåº•ç­–ç•¥
